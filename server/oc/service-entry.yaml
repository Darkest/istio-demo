apiVersion: networking.istio.io/v1alpha3
kind: ServiceEntry
metadata:
  name: external-svc-https
spec:
  hosts:
    - test.ext
  addresses:
    - 192.168.1.13
  location: MESH_EXTERNAL
  ports:
    - number: 8080
      name: http
      protocol: HTTP
  resolution: DNS
  endpoints:
    - address: 192.168.1.13
      ports:
        http: 8081
      locality: 'eu-central-2/zone2'
    - address: 192.168.1.13
      ports:
        http: 8080
      locality: 'eu-central-1/zone1'
    - address: istio-ingressgateway-istio-system.apps-crc.testing
      ports:
        http: 30765
      locality: 'eu-central-2/zone1'

---
apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: external-policy
spec:
  host: test.ext
  trafficPolicy:
    connectionPool:
      tcp:
        maxConnections: 100
      http:
        http2MaxRequests: 1000
        maxRequestsPerConnection: 10
    outlierDetection:
      consecutiveErrors: 1
      interval: 10s
      baseEjectionTime: 10s
      maxEjectionPercent: 100
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: test.ext
spec:
  hosts:
    - test.ext
  http:
    - route:
        - destination:
            host: test.ext
      retries:
        attempts: 0